# Ralph Progress Log
Started: Sun Feb  1 08:46:04 PM CST 2026

## Codebase Patterns
- Typecheck using `npx tsc -b` (no typecheck script in package.json)
- Lint using `npm run lint` - pre-existing lint errors in DiceRoller.tsx and DarkModeContext.tsx are known issues
- SpeciesAncestryOption in src/types/index.ts is used for species-specific choices (e.g., Dragonborn draconic ancestry, Elven Lineage)
- To add spells with a source, use: `{ ...getSpellByName('SpellName'), source: 'Lineage' }` - the source field is optional and displayed in CharacterSheetPage
- Spell interface has optional `notes` field for special rules (e.g., 'Once per Long Rest without a spell slot') - displayed in amber/italic below description
- Use `getLineageSpellsForLevelUp(character, prevLevel, newLevel)` to get lineage spells granted on level-up
---

## 2026-02-01 20:46 CST - US-001
- What was implemented: Added four optional fields to SpeciesAncestryOption interface for Elven Lineage support
- Files changed: src/types/index.ts
- **Learnings for future iterations:**
  - SpeciesAncestryOption is used for species ancestry choices - it now supports speedOverride, darkvisionOverride, cantrip, and leveledSpells
  - The codebase has pre-existing lint errors that are not blockers for commits
  - Use `npx tsc -b` for typechecking since there's no typecheck script
---

## 2026-02-01 20:48 CST - US-002
- What was implemented: Added ancestry data for Elven Lineages (Drow, High Elf, Wood Elf) to Elf species
- Files changed: src/data/species.ts
- **Learnings for future iterations:**
  - Elf species in species.ts now has an ancestry field with choiceName 'Elven Lineage' and three options
  - Drow: darkvisionOverride=120, cantrip='Dancing Lights', leveledSpells=[{level:3, Faerie Fire}, {level:5, Darkness}]
  - High Elf: cantrip='Prestidigitation', leveledSpells=[{level:3, Detect Magic}, {level:5, Misty Step}]
  - Wood Elf: speedOverride=35, cantrip='Druidcraft', leveledSpells=[{level:3, Longstrider}, {level:5, Pass Without Trace}]
  - Follow existing ancestry patterns in species.ts (e.g., Dragonborn, Gnome, Tiefling, Goliath, Aasimar)
---

## 2026-02-01 21:05 CST - US-003
- What was implemented: Applied lineage speed and darkvision overrides during character creation
- Files changed: src/pages/CharacterCreatePage.tsx
- **Learnings for future iterations:**
  - Character creation applies ancestry overrides in `handleCreateCharacter` function around line 740
  - `finalSpeed` is calculated from `speedOverride` if present, otherwise from species default
  - `finalSpeciesTraits` maps over species traits and updates Darkvision description if `darkvisionOverride` is present
  - The pattern for modifying traits: map over the array and replace matching trait with updated description
---

## 2026-02-01 21:15 CST - US-004
- What was implemented: Added lineage cantrip to character's spells array during character creation
- Files changed: src/types/index.ts, src/data/spells.ts, src/pages/CharacterCreatePage.tsx, src/pages/CharacterSheetPage.tsx
- **Learnings for future iterations:**
  - Spell interface now has optional `source` field to track origin (e.g., 'Lineage', 'Class', 'Feat')
  - Dancing Lights cantrip was added to spells.ts (was missing from spell data)
  - Lineage cantrips are added in `handleCreateCharacter` using `getSpellByName` to look up spell data
  - CharacterSheetPage displays spell source as an emerald-colored badge next to the level badge
  - Pattern for adding lineage spells: get spell data with `getSpellByName`, spread it, add source field
---

## 2026-02-01 21:30 CST - US-005
- What was implemented: Added lineage spells when character levels up to 3 or 5
- Files changed: src/utils/calculations.ts, src/pages/CharacterSheetPage.tsx, src/types/index.ts
- **Learnings for future iterations:**
  - Created `getLineageSpellsForLevelUp(character, previousLevel, newLevel)` utility in calculations.ts
  - The function looks up species ancestry, finds the selected option, and returns spells for threshold levels
  - Lineage spells are added in `completeLevelUp` function in CharacterSheetPage.tsx after class spells
  - Added `notes` optional field to Spell interface for special casting rules (e.g., "Once per Long Rest without a spell slot")
  - Notes are displayed in amber/italic below the spell description in the expanded spell view
  - To integrate with level-up, call `getLineageSpellsForLevelUp` and add results to character's spells array
---

## 2026-02-01 21:45 CST - US-006
- What was implemented: Updated Keen Senses trait to allow choice of Insight, Perception, or Survival proficiency
- Files changed: src/data/species.ts, src/pages/CharacterCreatePage.tsx
- **Learnings for future iterations:**
  - Keen Senses trait description now mentions all three skill options
  - Added `keenSensesSkill` state in CharacterCreatePage for Elves
  - Dropdown appears when Elf species is selected, alongside the Elven Lineage selection
  - Skill proficiency is applied in `finalSkills` during character creation, similar to background skills
  - Validation ensures Keen Senses skill is selected before allowing character creation for Elves
  - Pattern for species-specific skill choices: add state, add UI conditionally based on species, apply in finalSkills computation
---

## 2026-02-01 22:00 CST - US-007
- What was implemented: Added migration modal for existing Elf characters without lineage selection
- Files changed: src/pages/CharacterSheetPage.tsx
- **Learnings for future iterations:**
  - Migration modals should be blocking (no dismiss without selection) by omitting Cancel button
  - Detect missing data in useEffect: `if (character && character.species === 'Elf' && !character.speciesAncestry)`
  - Import `getSpellByName` from '../data/spells' for looking up spell data
  - Apply all migration changes atomically: speciesAncestry, speed, speciesTraits, spells, skills
  - For level-based lineage spells, check `character.level >= leveledSpell.level` to grant all applicable spells
  - Save migration immediately (not debounced) since it's a one-time critical update
  - Use `getSpeciesByName('Elf')?.ancestry?.options` to access lineage options in the modal
---
