# Ralph Progress Log
Started: Sun Feb  2 12:00:00 AM CST 2026
---

## Codebase Patterns
- Level-up flow in CharacterSheetPage uses pendingLevelUp state to track multi-step modals
- Class features are defined in src/data/classes.ts with Subclass interface
- Spell type includes optional source field for tracking origin (e.g., 'Lineage', 'Subclass')
- Subclass data includes features array and spells?: SubclassSpellGrant[] field
- SubclassSpellGrant interface: { level: number; spells: string[] }
- Spells database in src/data/spells.ts uses Spell interface with name, level, school, etc.
- AC calculation is in src/utils/calculations.ts with calculateAC function
- Character type defined in src/types/index.ts
- SubclassACCalculation interface: { type: 'unarmored'; base: number; abilities: AbilityName[] }
- Draconic Sorcery uses 2024 PHB AC: 13 + DEX (not 2014 10+DEX+CHA)

---

## 2026-02-02 - US-012: Display resource info in level-up summary
- Added ResourceChange interface to LevelUpSummaryModal.tsx
- Added resourceChanges prop to LevelUpSummaryModal component
- Added teal-colored "Resource Changes" section showing changes
- Shows "New!" label for resources that became available at this level
- Shows "X → Y (+Z)" format for resources with increased maximum
- Updated levelUpSummary state type to include resourceChanges
- Modified completeLevelUp to track resource changes during level-up
- Passed resourceChanges to LevelUpSummaryModal when rendered
- Files changed: src/components/LevelUpSummaryModal.tsx, src/pages/CharacterSheetPage.tsx
- **Learnings for future iterations:**
  - LevelUpSummaryModal already handles various change displays (HP, spell slots, features)
  - Follow existing pattern: interface for change type, prop for modal, track during level-up
  - Use consistent color scheme (teal for resources matches other sections' distinct colors)

---

## 2026-02-02 - US-011: Handle level-scaled resources on level-up
- Updated completeLevelUp to recalculate resource maximums at new level
- If max increased (e.g., Rage 2->3), grants the extra uses
- If resource became available at new level, initializes to max
- If max somehow decreased, clamps current to new max
- Imported initializeClassResources for initialization
- Files changed: src/pages/CharacterSheetPage.tsx
- **Learnings for future iterations:**
  - Compare oldMax to newMax to determine how to update current value
  - Use null check for resources that don't exist yet (minLevel not reached)
  - Ability scores might change during level-up (ASI), use updatedCharacter.abilityScores

---

## 2026-02-02 - US-009 & US-010: Add short rest and long rest functionality
- Added Short Rest button (blue) to Class Resources header
- Added Long Rest button (purple) to Class Resources header
- Both show window.confirm() with list of what will reset
- Short Rest: resets resources with resetOn: 'short'
- Long Rest: resets ALL resources, HP to max, all spell slots, Pact Magic
- Reuses subclassProficiencyNotification state for toast messages
- Files changed: src/pages/CharacterSheetPage.tsx
- **Learnings for future iterations:**
  - window.confirm() works for simple confirmations
  - Spell slots are stored with 'used' count, reset to 0
  - Pact Magic has 'expended' count, reset to 0
  - Reuse notification state rather than creating new state

---

## 2026-02-02 - US-008: Implement resource usage controls
- Added - button (red) to use/decrease resource
- Added + button (green) to restore/increase resource
- Buttons disabled at limits (0 for -, max for +)
- Made pips clickable for resources with ≤6 max uses
- Changes auto-save via updateCharacter spread pattern
- Files changed: src/pages/CharacterSheetPage.tsx
- **Learnings for future iterations:**
  - Use Math.max(0, value) and Math.min(max, value) for clamping
  - Spread existing resources when updating: { ...character.resources, [name]: value }
  - disabled prop + cursor-not-allowed class for disabled buttons

---

## 2026-02-02 - US-007: Create class resources UI section
- Added Class Resources section before Class Features in CharacterSheetPage
- Shows resource name with SR/LR badge (blue for short, purple for long)
- Fillable pips for resources with ≤6 max uses
- Numeric current/max display for resources with >6 max uses
- Infinity symbol (∞) for unlimited resources (L20 Rage)
- Imports getResourceMax and getResourceResetType from calculations.ts
- Files changed: src/pages/CharacterSheetPage.tsx
- **Learnings for future iterations:**
  - Use IIFE pattern {(() => { ... })()} for inline calculations in JSX
  - Filter resources by minLevel before rendering
  - Pips work well for small numbers (≤6), use counter for larger

---

## 2026-02-02 - US-006: Add resource tracking to Character type
- Added resources?: Record<string, number> to Character interface
- Created getResourceMax function for calculating max uses based on level/ability
- Created initializeClassResources to set up resources on character creation
- Created getResourceResetType to handle reset type changes (Bardic Inspiration at L5)
- Updated CharacterCreatePage to initialize resources
- Files changed: src/types/index.ts, src/utils/calculations.ts, src/pages/CharacterCreatePage.tsx
- **Learnings for future iterations:**
  - Resources stored as simple name -> current uses mapping
  - Max uses calculated on-demand from class data + level + ability scores
  - Use 999 for "unlimited" resources (Rage at L20)
  - getClassByName imported into calculations.ts for resource lookup

---

## 2026-02-02 - US-005: Add class resource definitions
- Created ClassResource interface with maxUses, resetOn, levelScaling, minLevel, resetOnShortAtLevel
- Added resources? field to ClassData interface
- Added Rage to Barbarian with level scaling (2/3/4/5/6/∞)
- Added Bardic Inspiration to Bard with ability-based uses and resetOnShortAtLevel
- Added Channel Divinity to Cleric with level scaling
- Added Wild Shape to Druid
- Added Second Wind, Action Surge, Indomitable to Fighter
- Added Hunter's Mark to Ranger (WIS-based, replaces Favored Foe concept)
- Added Arcane Recovery to Wizard
- Files changed: src/data/classes.ts
- **Learnings for future iterations:**
  - maxUses can be number | 'level' | 'proficiency' | 'ability' for different scaling
  - levelScaling: Record<number, number> overrides maxUses at specific levels
  - resetOnShortAtLevel allows Bardic Inspiration's L5 change from long to short rest
  - Monk Focus Points and Sorcerer Sorcery Points have their own custom UI

---

## 2026-02-02 - US-004: Auto-grant subclass proficiencies on selection
- Created applySubclassProficiencies helper function
- Updates both completeLevelUp and handleRequiredSubclassConfirm to apply proficiencies
- Deduplicates proficiencies with case-insensitive comparison
- Added subclassProficiencyNotification state for toast notification
- Added emerald notification toast UI with dismiss button and auto-hide (5s)
- Files changed: src/pages/CharacterSheetPage.tsx
- **Learnings for future iterations:**
  - Character.proficiencies has armor, weapons, tools arrays (not separate fields)
  - Use setTimeout for auto-hiding notifications
  - applySubclassProficiencies returns both updated character and list of granted profs

---

## 2026-02-02 - US-003: Add subclass proficiency data to class definitions
- Created SubclassProficiencies interface with armor, weapons, tools, skills fields
- Added proficiencies? field to Subclass interface
- Added proficiencies to War Domain: Heavy Armor, Martial Weapons
- Added proficiencies to College of Valor: Medium Armor, Shields, Martial Weapons
- Created new College of Swords subclass with proficiencies: Medium Armor, Scimitar
- Updated Bard College feature description to include College of Swords
- Files changed: src/data/classes.ts
- **Learnings for future iterations:**
  - College of Valor also grants Shields proficiency (updated feature description)
  - College of Swords was missing from codebase - added full subclass definition
  - Import SkillName from types when adding skills to proficiencies

---

## 2026-02-02 - US-002: Implement subclass AC in AC calculation
- Created calculateACWithSource function that returns {ac: number, source: string}
- Updated calculateAC to accept optional subclassName and chaMod parameters
- When unarmored, now compares all AC options (base, class, subclass) and picks highest
- CharacterSheetPage now uses calculateACWithSource and displays source in breakdown
- Added getSubclass import to CharacterSheetPage
- Files changed: src/utils/calculations.ts, src/pages/CharacterSheetPage.tsx
- **Learnings for future iterations:**
  - Use ACCalculationResult interface for returning both AC value and source
  - acOptions array pattern: collect all possible ACs, then reduce to find best
  - CharacterSheetPage has separate breakdown logic that may need updating for new AC sources

---

## 2026-02-02 - US-001: Add subclass AC calculation data to class definitions
- Created SubclassACCalculation interface with type, base, and abilities fields
- Added acCalculation? field to Subclass interface
- Added Draconic Sorcery AC calculation: base 13 + DEX
- Updated Draconic Resilience description to match 2024 PHB (was 10+DEX+CHA)
- Files changed: src/data/classes.ts
- **Learnings for future iterations:**
  - 2024 PHB changed Draconic Resilience from 10+DEX+CHA to 13+DEX
  - Base class unarmored defenses (Monk, Barbarian) are already hardcoded in calculateAC

---

