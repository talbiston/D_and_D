{
  "project": "D&D Character Sheet",
  "branchName": "ralph/subclass-mechanics",
  "description": "Subclass Mechanical Benefits - AC calculations, auto-grant proficiencies, and class resource tracking with rest functionality",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add subclass AC calculation data to class definitions",
      "description": "As a developer, I need subclass AC calculation formulas stored in the class definitions so the app can compute AC correctly.",
      "acceptanceCriteria": [
        "Add `acCalculation?: { type: 'unarmored'; base: number; abilities: AbilityName[] }` field to Subclass interface",
        "Add Draconic Sorcerer AC: base 13 + DEX (Draconic Resilience)",
        "Verify base class unarmored defenses exist (Monk: 10+DEX+WIS, Barbarian: 10+DEX+CON)",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Added SubclassACCalculation interface with type, base, abilities fields. Added acCalculation to Subclass interface. Added Draconic Sorcery with base 13 + DEX. Updated description to match 2024 PHB."
    },
    {
      "id": "US-002",
      "title": "Implement subclass AC in AC calculation",
      "description": "As a player with a Draconic Sorcerer, I want my AC to automatically use Draconic Resilience when not wearing armor.",
      "acceptanceCriteria": [
        "Update `calculateAC` function to check for subclass AC calculations",
        "When unarmored, use highest of: base 10+DEX, class unarmored defense, or subclass unarmored defense",
        "Display source of AC calculation in AC breakdown tooltip",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Added calculateACWithSource function returning {ac, source}. Updated calculateAC to accept subclass name and CHA mod. When unarmored, picks highest AC from base, class defense, or subclass. CharacterSheetPage uses acResult.source for breakdown display."
    },
    {
      "id": "US-003",
      "title": "Add subclass proficiency data to class definitions",
      "description": "As a developer, I need subclass-granted proficiencies stored in the class definitions.",
      "acceptanceCriteria": [
        "Add `proficiencies?: { armor?: string[]; weapons?: string[]; tools?: string[]; skills?: SkillName[] }` field to Subclass interface",
        "Add War Domain: heavy armor, martial weapons",
        "Add College of Valor: medium armor, shields, martial weapons",
        "Add College of Swords: medium armor, scimitar",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Added SubclassProficiencies interface. War Domain has Heavy Armor and Martial Weapons. College of Valor has Medium Armor, Shields, Martial Weapons. Added new College of Swords subclass with Medium Armor and Scimitar."
    },
    {
      "id": "US-004",
      "title": "Auto-grant subclass proficiencies on selection",
      "description": "As a player, when I choose a subclass that grants proficiencies, I want them automatically added to my character.",
      "acceptanceCriteria": [
        "When subclass is selected, check for proficiencies field",
        "Add armor proficiencies to character.armorProficiencies",
        "Add weapon proficiencies to character.weaponProficiencies",
        "Show notification listing granted proficiencies",
        "Don't add duplicates if already proficient",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Added applySubclassProficiencies helper. Automatically grants armor/weapon/tool proficiencies on subclass selection. Shows emerald notification toast. Deduplicates using case-insensitive comparison."
    },
    {
      "id": "US-005",
      "title": "Add class resource definitions",
      "description": "As a developer, I need class resource data (uses, reset type) stored in class definitions.",
      "acceptanceCriteria": [
        "Create `ClassResource` interface: `{ name: string; maxUses: number | 'level' | 'ability'; ability?: AbilityName; resetOn: 'short' | 'long'; levelScaling?: Record<number, number> }`",
        "Add `resources?: ClassResource[]` field to ClassData interface",
        "Add Barbarian: Rage (level-scaled uses, long rest)",
        "Add Bard: Bardic Inspiration (CHA mod uses, long rest; short rest at L5)",
        "Add Cleric: Channel Divinity (1/2/3 uses at L2/6/18, short rest)",
        "Add Druid: Wild Shape (2 uses, short rest)",
        "Add Fighter: Second Wind (1 use, short rest), Action Surge (1-2 uses, short rest), Indomitable (1-3 uses, long rest)",
        "Add Ranger: Favored Foe (PB uses, long rest)",
        "Add Wizard: Arcane Recovery (1 use, long rest)",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Added ClassResource interface with maxUses, resetOn, levelScaling, minLevel, resetOnShortAtLevel fields. Added resources to Barbarian (Rage), Bard (Bardic Inspiration), Cleric (Channel Divinity), Druid (Wild Shape), Fighter (Second Wind, Action Surge, Indomitable), Ranger (Hunter's Mark), Wizard (Arcane Recovery). Monk and Sorcerer have existing UI for their resources."
    },
    {
      "id": "US-006",
      "title": "Add resource tracking to Character type",
      "description": "As a developer, I need to store current resource usage on the character.",
      "acceptanceCriteria": [
        "Add `resources?: Record<string, number>` field to Character interface for tracking current uses",
        "Initialize resources when character is created or gains class features",
        "Preserve resource values on character save/load",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Added resources?: Record<string, number> to Character interface. Created getResourceMax, initializeClassResources, and getResourceResetType helpers in calculations.ts. CharacterCreatePage initializes resources on creation."
    },
    {
      "id": "US-007",
      "title": "Create class resources UI section",
      "description": "As a player, I want to see my class resources (Rage, Channel Divinity, etc.) with current/max uses.",
      "acceptanceCriteria": [
        "Add 'Class Resources' section to character sheet (in Features tab or new section)",
        "Display each resource with name, current/max uses, and reset indicator",
        "Reset indicator shows icon/badge: 'SR' for short rest, 'LR' for long rest",
        "Current uses shown as fillable pips or counter",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Added Class Resources section before Class Features. Shows resource name, SR/LR badge, and pips (≤6 uses) or numeric counter (>6 uses). Blue for short rest, purple for long rest. Infinity symbol for unlimited."
    },
    {
      "id": "US-008",
      "title": "Implement resource usage controls",
      "description": "As a player, I want to use and restore my class resources with +/- buttons.",
      "acceptanceCriteria": [
        "Each resource has - button to use (decrease current)",
        "Each resource has + button to restore (increase current, up to max)",
        "Cannot go below 0 or above max",
        "Changes save automatically",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Added +/- buttons for resource controls. Red - button to use, green + button to restore. Disabled at limits. Clickable pips for ≤6 max uses. Auto-saves via updateCharacter."
    },
    {
      "id": "US-009",
      "title": "Add short rest functionality",
      "description": "As a player, I want a 'Short Rest' button that resets appropriate resources.",
      "acceptanceCriteria": [
        "Add 'Short Rest' button to character sheet header or rest section",
        "Clicking shows confirmation with list of resources that will reset",
        "On confirm, reset all resources with `resetOn: 'short'` to max",
        "Show toast/notification confirming rest completed",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Added Short Rest button with confirmation dialog. Resets resources with resetOn: 'short'. Shows toast notification on completion."
    },
    {
      "id": "US-010",
      "title": "Add long rest functionality",
      "description": "As a player, I want a 'Long Rest' button that resets all resources and HP.",
      "acceptanceCriteria": [
        "Add 'Long Rest' button to character sheet header or rest section",
        "Clicking shows confirmation with list of what will reset",
        "On confirm, reset ALL class resources to max",
        "Restore HP to max",
        "Reset spell slots to max (if applicable)",
        "Show toast/notification confirming rest completed",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Added Long Rest button with confirmation dialog. Resets ALL resources, HP to max, and all spell slots (including Pact Magic). Shows toast notification."
    },
    {
      "id": "US-011",
      "title": "Handle level-scaled resources",
      "description": "As a player leveling up, I want my resource maximums to update automatically.",
      "acceptanceCriteria": [
        "Create helper function `getResourceMax(resource, level, abilityScores)`",
        "Rage uses: 2 at L1, 3 at L3, 4 at L6, 5 at L12, 6 at L17, unlimited at L20",
        "Channel Divinity: 1 at L2, 2 at L6, 3 at L18",
        "Action Surge: 1 at L2, 2 at L17",
        "Indomitable: 1 at L9, 2 at L13, 3 at L17",
        "Bardic Inspiration: CHA modifier (minimum 1)",
        "On level-up, recalculate and update max values",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Updated completeLevelUp to recalculate resource maximums. Grants extra uses if max increased, initializes new resources, and clamps to new max if decreased."
    },
    {
      "id": "US-012",
      "title": "Display resource info in level-up summary",
      "description": "As a player leveling up, I want to see if my resource maximums increased.",
      "acceptanceCriteria": [
        "LevelUpSummaryModal shows 'Resource Changes' section if any max changed",
        "Display: '[Resource Name]: X -> Y uses'",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Added ResourceChange interface to LevelUpSummaryModal. Shows teal-colored Resource Changes section with 'New!' for newly available resources and 'X → Y (+Z)' for increased maximums."
    }
  ]
}
