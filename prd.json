{
  "project": "D&D Character Sheet Backend API",
  "branchName": "ralph/backend-api",
  "description": "Backend API with SQLite storage for persistent character data, replacing localStorage with Docker-containerized Express server deployed to Fly.io",
  "userStories": [
    {
      "id": "US-001",
      "title": "Set up Express server with TypeScript",
      "description": "As a developer, I need a basic Express server structure to build the API on.",
      "acceptanceCriteria": [
        "Create server/ directory with Express + TypeScript setup",
        "Add server/index.ts with basic Express app listening on PORT env var (default 3001)",
        "Add health check endpoint GET /api/health returning { status: 'ok' }",
        "Add server/package.json with dependencies: express, cors, typescript, ts-node, @types/express, @types/cors",
        "Add server/tsconfig.json for TypeScript compilation",
        "Server starts without errors via npm run dev",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Set up SQLite database with schema",
      "description": "As a developer, I need a SQLite database to store character data.",
      "acceptanceCriteria": [
        "Install better-sqlite3 package in server/",
        "Create server/db/schema.sql with characters table",
        "Characters table: id (TEXT PRIMARY KEY), name (TEXT), data (TEXT/JSON), created_at (TEXT), updated_at (TEXT)",
        "Create server/db/index.ts that initializes database and runs schema",
        "Database file created at ./data/characters.db",
        "Database initializes on server start",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Create character POST endpoint",
      "description": "As a user, I want to create a new character and get a unique ID for it.",
      "acceptanceCriteria": [
        "POST /api/characters accepts JSON body with character data",
        "Generates unique ID using nanoid",
        "Stores character in SQLite with JSON.stringify for data field",
        "Returns { id: string, ...characterData }",
        "Returns 400 if body is missing or invalid",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Create character GET endpoint",
      "description": "As a user, I want to retrieve a character by its unique ID.",
      "acceptanceCriteria": [
        "GET /api/characters/:id returns character data",
        "Returns full character JSON with id included",
        "Returns 404 with { error: 'Character not found' } if ID doesn't exist",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Create character PUT endpoint",
      "description": "As a user, I want to update an existing character's data.",
      "acceptanceCriteria": [
        "PUT /api/characters/:id accepts JSON body with updated character data",
        "Updates character in SQLite",
        "Updates updated_at timestamp to current ISO datetime",
        "Returns updated character data with id",
        "Returns 404 if character not found",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Create character DELETE endpoint",
      "description": "As a user, I want to delete a character I no longer need.",
      "acceptanceCriteria": [
        "DELETE /api/characters/:id removes character from database",
        "Returns { success: true } on successful deletion",
        "Returns 404 if character not found",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Create characters list endpoint",
      "description": "As a user, I want to see all available characters.",
      "acceptanceCriteria": [
        "GET /api/characters returns array of character summaries",
        "Each summary includes: id, name, class, level, species, updated_at",
        "Sorted by updated_at descending (most recent first)",
        "Returns empty array if no characters exist",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-008",
      "title": "Create Dockerfile for full application",
      "description": "As a developer, I need a Dockerfile that builds both frontend and backend.",
      "acceptanceCriteria": [
        "Create Dockerfile in project root",
        "Multi-stage build: stage 1 builds frontend, stage 2 builds backend, stage 3 runs production",
        "Frontend built with npm run build, output in dist/",
        "Backend serves static files from dist/ directory",
        "SQLite data directory at /data for persistent volume",
        "Exposes port 3000",
        "Container builds successfully with docker build -t dnd-app .",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-009",
      "title": "Add Fly.io configuration",
      "description": "As a developer, I need Fly.io config files for deployment.",
      "acceptanceCriteria": [
        "Create fly.toml with app configuration",
        "Configure internal port 3000",
        "Configure persistent volume mount at /data for SQLite",
        "Set up health check endpoint at /api/health",
        "Configure single instance (min_machines_running = 1)",
        "Add .dockerignore to exclude node_modules, .git, data/",
        "Add deployment instructions to README.md",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Create API client utilities",
      "description": "As a developer, I need frontend utilities to communicate with the backend API.",
      "acceptanceCriteria": [
        "Create src/utils/api.ts with API functions",
        "createCharacter(data): POST /api/characters, returns { id, ...data }",
        "getCharacter(id): GET /api/characters/:id, returns character or throws",
        "updateCharacter(id, data): PUT /api/characters/:id, returns updated character",
        "deleteCharacter(id): DELETE /api/characters/:id, returns { success: true }",
        "listCharacters(): GET /api/characters, returns array of summaries",
        "API base URL from import.meta.env.VITE_API_URL or defaults to '' (same origin)",
        "Handle fetch errors and throw with meaningful messages",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Update character creation to use API",
      "description": "As a user, I want creating a character to save it to the server and give me a shareable ID.",
      "acceptanceCriteria": [
        "CharacterCreatePage calls createCharacter() API on form submit",
        "Show loading spinner during save",
        "On success, redirect to /character/:id using the returned ID",
        "Show error message if save fails with retry option",
        "Remove localStorage saving from creation flow",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 11,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Update character sheet to load from API",
      "description": "As a user, I want to view a character by going to its unique URL.",
      "acceptanceCriteria": [
        "CharacterSheetPage reads id from URL params using useParams()",
        "Calls getCharacter(id) API on mount",
        "Shows loading spinner while fetching",
        "Shows 404-style message if character not found",
        "Character data populates the sheet correctly on success",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 12,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Add auto-save for character changes",
      "description": "As a user, I want my character changes to save automatically.",
      "acceptanceCriteria": [
        "Character changes trigger updateCharacter() API call",
        "Debounce saves with 500ms delay after last change",
        "Show subtle 'Saving...' indicator in header during save",
        "Show 'Saved' confirmation for 2 seconds after success",
        "Show error indicator if save fails with manual retry button",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 13,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-014",
      "title": "Update home page to list characters from API",
      "description": "As a user, I want the home page to show all available characters from the server.",
      "acceptanceCriteria": [
        "HomePage calls listCharacters() API on mount",
        "Shows loading spinner while fetching",
        "Displays list of characters with name, class, level, species",
        "Each character card links to /character/:id",
        "Shows empty state message if no characters exist",
        "Add delete button on each card with confirmation dialog",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 14,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-015",
      "title": "Add shareable link UI",
      "description": "As a user, I want to easily copy a shareable link to my character.",
      "acceptanceCriteria": [
        "Character sheet header shows Share button or link icon",
        "Clicking copies the full URL to clipboard using navigator.clipboard.writeText()",
        "Shows brief 'Link copied!' toast/notification for 2 seconds",
        "URL format: {origin}/character/{id}",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 15,
      "passes": true,
      "notes": ""
    }
  ]
}
